{% include 'base.html' %}
<script >
    var form = {
        view:"form",
        id:"form",
        borderless:true,
        elements:[
            {rows:[
                {cols:[
                    {view:"combo", name:"rental_id", id:"rental_id", label:" 本の情報", width:500, labelWidth:65, labelAlign:"right",
                        dispV:"name", returnV:"id", value:"-H",
                         param:{
                          rental_id:"レンタルの情報",
                          syainn_id:"社員の情報",
                          flg:"0",
                          rental_id:"$$rental_id"
              },
          ajax:function(v,p,cb){sub_logic_CMLIG2000.getValue(v,p,cb)},
          ajaxPop:function(p,cb){sub_logic_CMLIG2000.show(p,cb)}
        },
        {}
                ]},
                {cols:[
                    {view:"label", label:"利用者ID", width:100},   //利用者ID入力画面追加
                    {view:"text", id:"user_id", name:"user_id", label:" ", labelWidth:1, width:150, attributes:{maxlength:6},disabled:true},
                ]},
                {cols:[
                    {view:"label", label:"借用日付", width:100},   //借用日付入力画面追加
                    {view:"text", id:"Borrow_date", name:"Borrow_date", label:" ", labelWidth:1, width:250},
                ]},
                {cols:[
                    {view:"label", label:"利用期間", width:100},   //利用期間入力画面追加
                    {view:"text", id:"usage_period", name:"usage_period", label:" ", labelWidth:1, width:250},
                ]},
                {cols:[
                    {view:"label", label:"書籍ＩＤ", width:100},   // 書籍ＩＤ入力
                    {view:"text", id:"book_id", name:"book_id", label:" ", labelWidth:1, width:150, attributes:{maxlength:6},disabled:true},
                ]},
                {cols:[
                    {view:"label", label:"スタッフコード", width:100},   //社員ID入力
                    {view:"text", id:"syainn_id", name:"syainn_id", label:" ", labelWidth:1, width:150, attributes:{maxlength:6},disabled:true},
                ]},
                {cols:[
                    {view:"label", label:"社員名", width:100},   //社員名入力
                    {view:"text", id:"syainn_name", name:"syainn_name", label:" ", labelWidth:1, width:150, attributes:{maxlength:6},disabled:true},
                ]},
                {cols:[
                    {view:"label", label:"書籍名称", width:100}, //書籍名称入力
                    {view:"text", id:"book_name", name:"book_name", label:" ", labelWidth:1, width:250,disabled:true},
                ]},
                {cols:[
                    {view:"label", label:"作者名", width:100}, //作者名入力
                    {view:"text", id:"author", name:"author", label:" ", labelWidth:1, width:250,disabled:true},
                ]},
                {cols:[
                    {view:"label", label:"料金", width:100},   //料金入力
                    {view:"text", id:"ryoukinn", name:"ryoukinn", label:" ", labelWidth:1, width:150, attributes:{maxlength:6},disabled:true},
                ]},
                 {cols:[
                    {view:"label", label:"カテゴリ", width:100}, //カテゴリ入力
                    {view:"select", id:"category", name:"category", label:" ", options:{{HtmlHelper.getJsonKara('cm_book_category')|raw}}, labelWidth:1, width:250,disabled:true},
                ]},
                {cols:[
                    {view:"label", label:"概要", width:100},    //概要入力
                    {view:"text", id:"overview", name:"overview", label:" ", labelWidth:1, width:250,disabled:true},
                ]},
                {cols:[
                    {view:"label", label:"出版社", width:100},  //出版社入力
                    {view:"text", id:"publisher", name:"publisher", label:" ", labelWidth:1, width:250,disabled:true},
                ]},
                 {view:"button", id:"btn_Register", name:"btn_Register", value:"情報の登録", css:"webix_primary", width:100, height:50},
            ]}
        ],
        rules:{
        }
    };
   var footer = {view:"button", id:"btn_back", name:"btn_back", value:"一覧に戻る", css:"webix_primary", width:150, height:50};
    var logic = {
        init:function() {
            logic.dataLoad();
            $$("btn_Register").attachEvent("onItemClick", logic.Register);
            $$("btn_back").attachEvent("onItemClick", logic.toMenu);
            $$("rental_id").attachEvent("onChange", logic.dataLoad);
        },
        dataLoad:function() {
            AUNG.GET("Api/ApiRentalRegister", {}, function(text, data, xml) {
                if(AUNG.isAjaxError()) return false;
                console.log(text);
                $$("form").parse(text);
            });

        Combo.ajax.get("/api/ApiRentalRegisetr", postData, function (text, xml, http) {
        if(Combo.ajax.isError(text))return false;
        var json = xml.json();
        Combo.datatable.parse("ichiran", json);
          },{date:$$("rental_id").getValue()});

        },
        Register:function() {
            if(!logic.validate()) {
                return false;
            }
            var _postData = $$("form").getValues();
             AUNG.POST("Api/ApiRentalRegister", _postData, function(text, data, xml) {
                if(AUNG.isAjaxError()) return false;
                webix.message("登録しました。");
                { logic.dataload(); }
            });
        },
        validate:function() {
            if(!$$("form").validate()) {
                AUNG.errorMessage("必須項目が不足しています。");
                return false;
            }
            return true;
        },
        toMenu:function() {
            AUNG.pageMove("RentalChoie");
        }
    };
    webix.ui(
        {rows:[
            form,
            {},
            footer,
            {height:60}
        ]}
    );
    webix.ready(function () {
        AUNG.init();
        logic.init();
    });
</script>